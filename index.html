<!DOCTYPE html>

<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sofa Advisor ‚Äî Jordan</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=DM+Mono:wght@400;500&family=Sora:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    :root{
      --bg:#0f0f10;--surface:#191920;--surface2:#21212b;--surface3:#2b2b38;
      --border:rgba(255,255,255,0.07);--border-hi:rgba(255,255,255,0.13);
      --gold:#f5b944;--gold-dim:rgba(245,185,68,0.14);--gold-glow:rgba(245,185,68,0.25);
      --green:#48c78e;--red:#f87171;
      --text:#e8e8f0;--text-muted:#7a7a94;--text-faint:#3d3d52;
      --r:12px;--r-sm:8px
    }
    html,body{height:100%;min-height:100%}
    body{font-family:'Sora',system-ui,sans-serif;background:var(--bg);color:var(--text);overflow-x:hidden;line-height:1.5}

```
.bg-glow{position:fixed;inset:0;pointer-events:none;z-index:0;
  background:radial-gradient(ellipse 70% 50% at 10% 0%,rgba(245,185,68,0.06) 0%,transparent 55%),
             radial-gradient(ellipse 50% 40% at 95% 100%,rgba(72,199,142,0.05) 0%,transparent 50%)}

.app-wrap{position:relative;z-index:1;max-width:860px;margin:0 auto;padding:28px 18px 70px}

header{display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:14px;margin-bottom:32px}
.header-left{display:flex;align-items:baseline;gap:12px}
.header-title{font-family:'DM Serif Display',Georgia,serif;font-size:clamp(22px,5vw,34px);color:var(--text);letter-spacing:-0.4px}
.header-badge{font-size:11px;font-weight:600;letter-spacing:1.5px;text-transform:uppercase;color:var(--gold);background:var(--gold-dim);border:1px solid rgba(245,185,68,0.28);padding:4px 11px;border-radius:100px}

.btn{display:inline-flex;align-items:center;gap:6px;padding:9px 16px;border-radius:var(--r-sm);font-family:'Sora',system-ui,sans-serif;font-size:13px;font-weight:500;cursor:pointer;border:1px solid transparent;transition:background .15s,transform .15s,box-shadow .15s;white-space:nowrap}
.btn-ghost{background:var(--surface2);color:var(--text-muted);border-color:var(--border-hi)}
.btn-ghost:hover{background:var(--surface3);color:var(--text)}
.btn-success{background:var(--green);color:#0f0f10;font-weight:600}
.btn-success:hover{background:#5dd8a2;transform:translateY(-1px);box-shadow:0 4px 18px rgba(72,199,142,0.35)}
.full-width{width:100%;justify-content:center}

/* FEATURED CARDS */
.featured-strip{display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-bottom:18px}
@media(max-width:600px){.featured-strip{grid-template-columns:1fr}}
.featured-card{background:var(--surface);border:1px solid var(--border-hi);border-radius:16px;padding:20px 22px;cursor:pointer;transition:transform .15s,border-color .2s,box-shadow .2s;position:relative;overflow:hidden}
.featured-card::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse 80% 60% at 0% 0%,rgba(245,185,68,0.07) 0%,transparent 70%);pointer-events:none}
.featured-card:hover{transform:translateY(-3px);border-color:rgba(245,185,68,0.4);box-shadow:0 8px 32px rgba(245,185,68,0.1)}
.featured-tag{display:inline-flex;align-items:center;gap:5px;font-size:10px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--gold);background:var(--gold-dim);border:1px solid rgba(245,185,68,0.25);padding:3px 9px;border-radius:100px;margin-bottom:10px}
.featured-name{font-family:'DM Serif Display',Georgia,serif;font-size:20px;color:var(--text);margin-bottom:6px;line-height:1.2}
.featured-price{font-size:13px;color:var(--gold);margin-bottom:8px;opacity:.85}
.featured-desc{font-size:12.5px;color:var(--text-muted);line-height:1.5}
.featured-cta{display:inline-flex;align-items:center;gap:5px;margin-top:14px;font-size:12px;font-weight:600;color:var(--gold);opacity:.7;transition:opacity .15s}
.featured-card:hover .featured-cta{opacity:1}

.chat-card{background:var(--surface);border:1px solid var(--border);border-radius:20px;height:calc(100vh - 320px);min-height:420px;display:flex;flex-direction:column;overflow:hidden}
.chat-header{display:flex;align-items:center;justify-content:space-between;padding:16px 22px;border-bottom:1px solid var(--border);background:var(--surface2)}
.chat-header-label{font-size:13px;font-weight:600;color:var(--text-muted);letter-spacing:.5px}
.live-dot{width:8px;height:8px;border-radius:50%;background:var(--green);box-shadow:0 0 8px var(--green);animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}

.chat-body{flex:1;padding:22px;overflow-y:auto;display:flex;flex-direction:column;gap:16px}
.chat-body::-webkit-scrollbar{width:4px}
.chat-body::-webkit-scrollbar-thumb{background:var(--surface3);border-radius:4px}

.message{display:flex;gap:12px;align-items:flex-start;max-width:88%}
.message.bot{align-self:flex-start}
.message.user{align-self:flex-end;flex-direction:row-reverse}
.avatar{width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0}
.message.bot .avatar{background:var(--gold);color:#0f0f10}
.message.user .avatar{background:var(--green);color:#0f0f10;font-size:12px;font-weight:700}
.bubble{background:var(--surface2);padding:13px 17px;border-radius:16px;border-top-left-radius:4px;line-height:1.6;font-size:13.5px}
.bubble p{margin:0 0 8px}
.bubble p:last-child{margin:0}
.bubble ul{margin:8px 0 8px 18px}
.bubble li{margin:4px 0}
.message.user .bubble{background:var(--gold);color:#0f0f10;border-top-left-radius:16px;border-top-right-radius:4px}

.mini-product{background:var(--surface3);border:1px solid var(--border);border-radius:10px;padding:12px 14px;margin:8px 0;cursor:pointer;transition:transform .15s,border-color .15s}
.mini-product:hover{transform:translateY(-2px);border-color:var(--gold)}
.mini-product strong{color:var(--gold);display:block;margin-bottom:2px}
.mini-product .price{color:var(--gold);font-size:13px;margin:2px 0;opacity:.8}
.mini-product small{color:var(--text-muted);font-size:12px;line-height:1.4}

.typing-indicator{display:flex;gap:5px;align-items:center;padding:4px 0}
.typing-indicator span{width:7px;height:7px;border-radius:50%;background:var(--text-muted);animation:typing 1.2s ease infinite}
.typing-indicator span:nth-child(2){animation-delay:.2s}
.typing-indicator span:nth-child(3){animation-delay:.4s}
@keyframes typing{0%,60%,100%{transform:translateY(0);opacity:.4}30%{transform:translateY(-6px);opacity:1}}

.chat-input-area{display:flex;gap:10px;padding:16px 20px;background:var(--surface2);border-top:1px solid var(--border)}
.chat-input{flex:1;background:var(--surface3);border:1px solid var(--border-hi);border-radius:var(--r-sm);color:var(--text);font-family:'DM Mono',monospace;font-size:13.5px;padding:12px 15px;outline:none;transition:border-color .15s,box-shadow .15s}
.chat-input:focus{border-color:var(--gold);box-shadow:0 0 0 3px rgba(245,185,68,0.1)}
.chat-input::placeholder{color:var(--text-faint)}

.modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.82);backdrop-filter:blur(8px);z-index:200;align-items:center;justify-content:center;padding:20px}
.modal-overlay.open{display:flex}
.modal-inner{background:var(--surface);border:1px solid var(--border-hi);border-radius:22px;width:100%;max-width:580px;max-height:90vh;display:flex;flex-direction:column;overflow:hidden}
.modal-header{display:flex;align-items:center;justify-content:space-between;padding:20px 24px;border-bottom:1px solid var(--border);background:var(--surface2)}
.modal-title{font-family:'DM Serif Display',Georgia,serif;font-size:20px;color:var(--text)}
.modal-close{background:none;border:none;color:var(--text-muted);font-size:22px;cursor:pointer;padding:4px 8px;border-radius:6px;transition:color .15s,background .15s;line-height:1}
.modal-close:hover{color:var(--text);background:var(--surface3)}
.modal-body{padding:24px;line-height:1.65;font-size:14px;overflow-y:auto;flex:1}
.modal-body p{margin:0 0 12px}
.modal-body p:last-child{margin:0}
.modal-body ul{margin:10px 0 10px 20px}
.modal-body li{margin:6px 0;font-size:13.5px}
.product-tag{display:inline-block;background:var(--surface3);border:1px solid var(--border);border-radius:6px;padding:2px 8px;font-size:11px;color:var(--text-muted);margin:2px}

::-webkit-scrollbar{width:5px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--surface3);border-radius:4px}
```

  </style>
</head>
<body>
<div class="bg-glow"></div>
<div class="app-wrap">

  <header>
    <div class="header-left">
      <h1 class="header-title">üõãÔ∏è Sofa Advisor</h1>
      <span class="header-badge">Jordan</span>
    </div>
    <button class="btn btn-ghost" id="connectAiBtn">ü§ñ Connect AI</button>
  </header>

  <!-- FEATURED NEW ARRIVALS -->

  <div class="featured-strip">
    <div class="featured-card" onclick="showFeatured('stellar')">
      <div class="featured-tag">‚ú® New Arrival</div>
      <div class="featured-name">Stellar Sofa</div>
      <div class="featured-price">From ¬£1,490</div>
      <div class="featured-desc">A bold new silhouette for Spring/Summer 2026 ‚Äî deep cloud-like cushions, a low-slung profile and a statement presence in any room.</div>
      <div class="featured-cta">View details ‚Üí</div>
    </div>
    <div class="featured-card" onclick="showFeatured('slimmarco')">
      <div class="featured-tag">‚ú® New Arrival</div>
      <div class="featured-name">Slim Marco Sofa</div>
      <div class="featured-price">From ¬£1,420</div>
      <div class="featured-desc">The iconic Marco reimagined with a slimmer, sleeker silhouette. New for Spring/Summer 2026 with 100+ fabrics and custom sizing.</div>
      <div class="featured-cta">View details ‚Üí</div>
    </div>
  </div>

  <div class="chat-card">
    <div class="chat-header">
      <span class="chat-header-label">Sofa Concierge AI</span>
      <div class="live-dot"></div>
    </div>
    <div class="chat-body" id="chatBody">
      <div id="messages"></div>
    </div>
    <div class="chat-input-area">
      <input id="chatInput" type="text" class="chat-input" placeholder="e.g. corner sofa under ¬£2000, or sofa bed for guests‚Ä¶" autocomplete="off">
      <button class="btn btn-success" id="sendBtn">Send ‚Üµ</button>
    </div>
  </div>

</div>

<!-- PRODUCT MODAL -->

<div id="productModal" class="modal-overlay">
  <div class="modal-inner">
    <div class="modal-header">
      <h2 id="modalProductName" class="modal-title"></h2>
      <button class="modal-close" id="closeModalBtn">√ó</button>
    </div>
    <div id="modalProductBody" class="modal-body"></div>
  </div>
</div>

<!-- API KEY MODAL -->

<div id="apiKeyModal" class="modal-overlay">
  <div class="modal-inner" style="max-width:460px">
    <div class="modal-header">
      <h2 class="modal-title">ü§ñ Connect Groq AI</h2>
      <button class="modal-close" id="closeApiKeyBtn">√ó</button>
    </div>
    <div class="modal-body">
      <p>Enable real AI responses powered by <strong>Llama 3.3 70B</strong> ‚Äî free and very fast.</p>
      <p style="font-size:12px;color:var(--text-muted);margin-top:6px">Get a free key at <a href="https://console.groq.com" target="_blank" style="color:var(--gold)">console.groq.com</a> ‚Äî takes 30 seconds.</p>
      <div style="margin-top:18px">
        <input id="apiKeyInput" type="password" placeholder="gsk_..."
          style="width:100%;background:var(--surface3);border:1px solid var(--border-hi);border-radius:8px;color:var(--text);font-family:'DM Mono',monospace;font-size:13px;padding:12px 14px;outline:none;margin-bottom:12px"
          autocomplete="off">
        <button class="btn btn-success full-width" id="saveApiKeyBtn">Save & Enable AI ‚úì</button>
      </div>
      <p style="margin-top:14px;font-size:11px;color:var(--text-faint)">Stored only in your browser's localStorage ‚Äî sent directly to Groq, nowhere else.</p>
    </div>
  </div>
</div>

<script>
/* ‚îÄ‚îÄ‚îÄ CATALOG ‚îÄ‚îÄ‚îÄ */
const catalog = {
  products: [
    {name:"Slim Marco Sofa",category:"Sofa",subcategory:"Spring/Summer 2026",starting_price:"From ¬£1,420",url:"https://www.sofa.com/gb/spring-summer-2026/slim-marco-sofa/p/SO-SMR",description:"Slim profile contemporary sofa from the Spring/Summer 2026 collection. 100+ fabrics and custom sizes available.",key_features:["Slim profile","Custom sizes","New for Spring/Summer 2026"]},
    {name:"Bluebell Sofa",category:"Sofa",subcategory:"Bespoke / Classic",starting_price:"From ¬£1,180",url:"https://www.sofa.com/gb/bespoke-sofas/bluebell-sofa/p/SO-BLU",description:"Classic pleated arm sofa with turned oak legs and bronze castors. Feather-wrapped foam seat cushions, feather & fibre back. Breakdownable option available.",key_features:["Pleated scrolled arms","Removable cushion covers","Sweetheart frame","Breakdownable for narrow hallways (+¬£280)"],variants:["2 Seat (W164cm)","2.5 Seat (W192cm)","3 Seat (W218cm)","4 Seat (W244cm)"]},
    {name:"Isla Sofa",category:"Sofa",subcategory:"Removable Covers",starting_price:"From ¬£1,230",url:"https://www.sofa.com/gb/bespoke-sofas/sofas-with-removable-covers/isla-sofa/p/SO-ISL",description:"Contemporary sofa with fully removable and washable covers ‚Äî perfect for families and busy homes.",key_features:["Fully removable covers","Machine washable","Family-friendly"]},
    {name:"Teddy Sofa",category:"Sofa",starting_price:"From ¬£1,580",url:"https://www.sofa.com/gb/bespoke-sofas/teddy-sofa/p/SO-TED",description:"Plush, generously proportioned sofa with deep cushioning. Available in 100+ fabrics including boucle and velvet.",key_features:["Deep cushioning","100+ fabrics","Multiple sizes"]},
    {name:"Izzy Sofa",category:"Sofa",subcategory:"Bestselling",starting_price:"From ¬£1,180",url:"https://www.sofa.com/gb/bespoke-sofas/bestselling-sofas/izzy-sofa/p/SO-IZZ",description:"One of sofa.com's bestselling sofas ‚Äî a modern classic with clean lines and exceptional comfort.",key_features:["Bestselling model","Clean contemporary lines","Multiple size options"]},
    {name:"Aissa Sofa Bed",category:"Sofa Bed",starting_price:"From ¬£2,150",url:"https://www.sofa.com/gb/beds/aissa-sofa-bed/p/SB-AIS",description:"Stylish sofa bed with a smooth fold-out mechanism. Available in multiple seat sizes and 100+ fabrics.",key_features:["Smooth fold-out mechanism","100+ fabrics","Multiple seat sizes"]},
    {name:"Isla Corner Sofa",category:"Corner Sofa",starting_price:"From ¬£2,180",url:"https://www.sofa.com/gb/bespoke-sofas/isla-corner-sofa/p/CS-ISL",description:"The Isla in a generous corner configuration with removable covers and contemporary styling.",key_features:["Corner configuration","Removable covers","LHF and RHF options"]},
    {name:"Bluebell Sofa Bed",category:"Sofa Bed",starting_price:"From ¬£1,400",url:"https://www.sofa.com/gb/beds/bluebell-sofa-bed/p/SB-BLB",description:"The classic Bluebell collection reimagined as a sofa bed. Pleated scrolled arms with fold-out bed mechanism.",key_features:["Classic Bluebell styling","Fold-out bed","Pleated scrolled arms"],variants:["2 Seat","Loveseat","2.5 Seat","3 Seat"]},
    {name:"Patrick Sofa",category:"Sofa",starting_price:"From ¬£1,310",url:"https://www.sofa.com/gb/bespoke-sofas/patrick-sofa/p/SO-PTR",description:"A refined bespoke sofa with classic proportions and handmade quality.",key_features:["Handmade bespoke","Classic proportions","Lifetime frame guarantee"]},
    {name:"Otto Sofa",category:"Sofa",subcategory:"Removable Covers",starting_price:"From ¬£1,310",url:"https://www.sofa.com/gb/bespoke-sofas/sofas-with-removable-covers/otto-sofa/p/SO-OTO",description:"A stylish sofa with practical removable and washable covers. Great for families, pets and busy homes.",key_features:["Removable machine-washable covers","Family and pet friendly","Contemporary styling"]},
    {name:"Costello Sofa",category:"Sofa",subcategory:"Classic Traditional",starting_price:"From ¬£1,480",url:"https://www.sofa.com/gb/bespoke-sofas/classic-traditional-sofas/costello-sofa/p/SO-CSP",description:"A classic British traditional sofa with high-back comfort and traditional craftsmanship.",key_features:["Classic traditional styling","High-back comfort","100+ fabrics"]},
    {name:"Long Island Modular Sofa",category:"Modular Sofa",starting_price:"From ¬£640",url:"https://www.sofa.com/gb/bespoke-sofas/corner-sofas/long-island-modular-sofa/p/CS-LON",description:"Flexible modular corner sofa system ‚Äî buy sections individually and build your ideal configuration.",key_features:["Fully modular system","Buy sections individually","Build any configuration"]},
    {name:"Anders Sofa",category:"Sofa",starting_price:"From ¬£1,850",url:"https://www.sofa.com/gb/bespoke-sofas/anders-sofa/p/FS-AND",description:"Contemporary sofa with clean lines and bespoke handmade quality.",key_features:["Contemporary design","Bespoke handmade","100+ fabrics"]},
    {name:"Ren Chaise Sofa",category:"Chaise Sofa",starting_price:"From ¬£2,080",url:"https://www.sofa.com/gb/bespoke-sofas/ren-chaise-sofa/p/CH-REN",description:"Elegant chaise sofa with extended lounging section. 100+ fabrics.",key_features:["Chaise lounging section","LHF and RHF options","100+ fabrics"]},
    {name:"Malibu Sofa",category:"Sofa",starting_price:"From ¬£2,380",url:"https://www.sofa.com/gb/bespoke-sofas/malibu-sofa/p/FS-MBU",description:"Premium sofa with a luxurious California-inspired silhouette. 100+ fabrics.",key_features:["Luxurious wide proportions","Premium materials","100+ fabrics"]},
    {name:"Teddy Chaise",category:"Chaise Sofa",starting_price:"From ¬£3,260",url:"https://www.sofa.com/gb/bespoke-sofas/chaise-lounge-sofas/teddy-chaise/p/CH-TED",description:"The plush Teddy collection in a generous chaise configuration.",key_features:["Plush deep cushioning","Chaise configuration","100+ fabrics"]},
    {name:"Sloane Modular Sofa",category:"Modular Sofa",starting_price:"From ¬£955",url:"https://www.sofa.com/gb/bespoke-sofas/sloane-modular-sofa/p/FM-SLO",description:"Affordable modular sofa with flexible configuration options.",key_features:["Modular flexible system","Excellent value","100+ fabrics"]},
    {name:"Costello Open End Chaise Sofa",category:"Chaise Sofa",starting_price:"From ¬£4,210",url:"https://www.sofa.com/gb/bespoke-sofas/costello-open-end-chaise-sofa/p/CH-CSP",description:"Generous traditional chaise sofa in the classic Costello style. Open-end design.",key_features:["Traditional Costello styling","Open-end chaise","100+ fabrics"]},
    {name:"Iggy Sofa",category:"Sofa",subcategory:"Bestselling",starting_price:"From ¬£1,180",url:"https://www.sofa.com/gb/bespoke-sofas/bestselling-sofas/iggy-sofa/p/SO-IGG",description:"A sofa.com bestseller with a modern, accessible design and exceptional comfort.",key_features:["Bestselling sofa","Modern accessible design","Multiple sizes"]},
    {name:"Long Island Slim Sofa Bed",category:"Sofa Bed",starting_price:"From ¬£2,150",url:"https://www.sofa.com/gb/beds/long-island-slim-sofa-bed/p/SB-SLN",description:"Slim-profile sofa bed from the Long Island modular range. Ideal for smaller rooms.",key_features:["Slim profile design","Fold-out bed mechanism","Modular range"]},
    {name:"Malibu Corner Sofa",category:"Corner Sofa",starting_price:"From ¬£5,610",url:"https://www.sofa.com/gb/bespoke-sofas/malibu-corner-sofa/p/FM-MBU",description:"Premium large corner sofa in the Malibu collection. 100+ fabrics.",key_features:["Premium corner configuration","Large generous proportions","100+ fabrics"]},
    {name:"Malibu Chaise Sofa",category:"Chaise Sofa",starting_price:"From ¬£3,850",url:"https://www.sofa.com/gb/bespoke-sofas/chaise-lounge-sofas/malibu-chaise-sofa/p/FC-MBU",description:"Luxurious chaise sofa from the premium Malibu collection.",key_features:["Premium Malibu collection","Chaise configuration","LHF and RHF options"]},
    {name:"Marco Sofa",category:"Sofa",starting_price:"From ¬£2,090",url:"https://www.sofa.com/gb/bespoke-sofas/marco-sofa/p/FS-MRC",description:"Contemporary sofa with a refined profile. 100+ fabrics.",key_features:["Refined contemporary profile","Bespoke handmade","100+ fabrics"]},
    {name:"Iggy High Back Seat Sofa",category:"Sofa",starting_price:"From ¬£2,160",url:"https://www.sofa.com/gb/bespoke-sofas/iggy-high-back-seat-sofa/p/FS-HIG",description:"The bestselling Iggy in a high-back configuration for extra head and neck support.",key_features:["High-back for extra support","Based on bestselling Iggy","100+ fabrics"]},
    {name:"Marco Corner Sofa",category:"Corner Sofa",starting_price:"From ¬£4,770",url:"https://www.sofa.com/gb/bespoke-sofas/marco-corner-sofa/p/CS-MRC",description:"The Marco collection in a generous corner format. 100+ fabrics.",key_features:["Corner configuration","Contemporary Marco styling","100+ fabrics"]},
    {name:"Holly Sofa",category:"Sofa",subcategory:"Mid-Century",starting_price:"From ¬£900",url:"https://www.sofa.com/gb/bespoke-sofas/mid-century/holly-sofa/p/SO-HOL",description:"An elegant mid-century inspired sofa with clean geometric lines and tapered legs.",key_features:["Mid-century design","Tapered legs","Great entry price"]},
    {name:"Marco Chaise Sofa",category:"Chaise Sofa",starting_price:"From ¬£3,280",url:"https://www.sofa.com/gb/bespoke-sofas/chaise-lounge-sofas/marco-chaise-sofa/p/FM-MRC",description:"The Marco collection in a chaise configuration. 100+ fabrics.",key_features:["Chaise configuration","Contemporary Marco styling","LHF and RHF options"]},
    {name:"Lars Sofa",category:"Sofa",starting_price:"From ¬£1,360",url:"https://www.sofa.com/gb/bespoke-sofas/lars-sofa/p/FS-LAR",description:"A sleek Scandinavian-influenced sofa with clean lines and a relaxed profile.",key_features:["Scandinavian-influenced design","Clean lines","Relaxed profile"]},
    {name:"High Back Iggy 2 Seat Recliner Sofa",category:"Recliner Sofa",starting_price:"From ¬£2,240",url:"https://www.sofa.com/gb/bespoke-sofas/high-back-iggy-2-seat-recliner-sofa/p/RS-HIG",description:"The Iggy in a high-back recliner configuration. Smooth reclining mechanism with lumbar support.",key_features:["High-back recliner","Smooth reclining mechanism","Lumbar support"]},
    {name:"Lars Corner Sofa",category:"Corner Sofa",starting_price:"From ¬£2,290",url:"https://www.sofa.com/gb/bespoke-sofas/lars-corner-sofa/p/CS-LAR",description:"The Scandinavian-influenced Lars in a corner configuration. 100+ fabrics.",key_features:["Corner configuration","Scandinavian design","LHF and RHF options"]},
    {name:"Aissa Corner Sofa Bed",category:"Corner Sofa Bed",starting_price:"From ¬£2,950",url:"https://www.sofa.com/gb/bespoke-sofas/aissa-corner-sofa-bed/p/CB-AIS",description:"A corner sofa that converts to a bed ‚Äî ideal for guest rooms. LHF/RHF variants.",key_features:["Corner + sofa bed in one","LHF and RHF options","Guest room solution"]},
    {name:"Aissa Chaise Sofa Bed",category:"Chaise Sofa Bed",starting_price:"From ¬£2,330",url:"https://www.sofa.com/gb/bespoke-sofas/aissa-chaise-sofa-bed/p/HB-AIS",description:"Chaise sofa with fold-out bed mechanism. Storage options available in some configurations.",key_features:["Chaise + sofa bed","Storage options","LHF and RHF options"]},
    {name:"Jack in a Box Bed",category:"Sofa Bed",starting_price:"From ¬£890",url:"https://www.sofa.com/gb/beds/jack-in-a-box-bed/p/BX-JIB",description:"A clever compact sofa bed with a simple unfold mechanism. Best value entry point.",key_features:["Compact clever design","Simple unfold mechanism","Best value sofa bed"]},
    {name:"Henry Bed In Box",category:"Sofa Bed",starting_price:"From ¬£1,290",url:"https://www.sofa.com/gb/beds/henry-bed-in-box/p/BX-HNR",description:"A space-saving bed-in-a-box sofa bed. 100+ fabrics.",key_features:["Space-saving design","Compact fold-out","100+ fabrics"]}
  ],
  fabrics: [
    {group:"Smart / Performance",examples:["Smart Velvet (spill-resistant, silky, family-friendly)","Easy Cotton (machine-washable, 100% cotton)","Aquaclean Canvas / Chenille / Velvet / Linen Look"]},
    {group:"House Collection (Italy)",examples:["House Herringbone Weave (highly durable, 100% cotton)","House Basket Weave","House Stripe","House Velvet"]},
    {group:"Velvets & Plush",examples:["Pure Cotton Matt Velvet","Luxe Boucle (twisted wool, Scandi texture)","Cashmere Velvet","Bubble Velvet"]},
    {group:"Linens & Naturals",examples:["Vermeer Linen (100% flax)","Baylee Viscose Linen (15% recycled cotton)","Brushed Linen Cotton"]},
    {group:"Leathers",examples:["Antique Leather","Grain Leather","Faux Leather"]}
  ]
};

// Parse price to number
catalog.products.forEach(p => {
  const m = p.starting_price.match(/¬£([\d,]+)/);
  p.price_num = m ? parseFloat(m[1].replace(/,/g,'')) : null;
});

/* ‚îÄ‚îÄ‚îÄ STATE ‚îÄ‚îÄ‚îÄ */
let groqApiKey = localStorage.getItem('groqApiKey') || '';
let messages = [];
let chatHistory = [];

/* ‚îÄ‚îÄ‚îÄ HELPERS ‚îÄ‚îÄ‚îÄ */
function escHtml(s){ return (s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

/* ‚îÄ‚îÄ‚îÄ MESSAGES ‚îÄ‚îÄ‚îÄ */
function addMessage(role, html) {
  messages.push({role, content: html});
  renderMessages();
}

function renderMessages() {
  document.getElementById('messages').innerHTML = messages.map(m => `
    <div class="message ${m.role}">
      <div class="avatar">${m.role==='bot' ? 'üõãÔ∏è' : 'J'}</div>
      <div class="bubble">${m.content}</div>
    </div>`).join('');
  document.getElementById('chatBody').scrollTop = 99999;
}

function showTyping() {
  const d = document.createElement('div');
  d.className = 'message bot'; d.id = 'typing';
  d.innerHTML = `<div class="avatar">üõãÔ∏è</div><div class="bubble"><div class="typing-indicator"><span></span><span></span><span></span></div></div>`;
  document.getElementById('messages').appendChild(d);
  document.getElementById('chatBody').scrollTop = 99999;
}

function removeTyping() {
  const t = document.getElementById('typing');
  if (t) t.remove();
}

/* ‚îÄ‚îÄ‚îÄ PRODUCT CARD & MODAL ‚îÄ‚îÄ‚îÄ */
function isModular(p) {
  return p.category === 'Modular Sofa' || (p.name||'').toLowerCase().includes('modular');
}

function productCard(p) {
  const idx = catalog.products.indexOf(p);
  const modNote = isModular(p)
    ? `<div style="font-size:11px;color:var(--text-faint);margin-top:4px">*Price is per single module</div>`
    : '';
  return `<div class="mini-product" data-index="${idx}">
    <strong>${escHtml(p.name)}</strong>
    <div class="price">${escHtml(p.starting_price)}</div>
    <small>${escHtml((p.description||'').substring(0,110))}‚Ä¶</small>
    ${modNote}
  </div>`;
}

/* ‚îÄ‚îÄ‚îÄ FEATURED MODAL ‚îÄ‚îÄ‚îÄ */
const featuredData = {
  stellar: {
    name: 'Stellar Armchair',
    price: 'From ¬£790',
    url: 'https://www.sofa.com/gb/spring-summer-2026/stellar-armchair/p/AC-STR',
    description: 'Rest a cup of tea upon the integrated side table, nestled in the armrest and allow Stellar to cocoon you in its organic shape. Generous in size, Stellar makes a stunning, contemporary statement in your home, whilst prioritising comfort in its composition. Not to be ignored, our dedicated design team created the asymmetric Stellar with function in mind, making it a truly one-of-a-kind silhouette joining our collection. Available in 100+ fabrics.',
    key_features: ['New for Spring/Summer 2026','LHF/ RHF built-in table','100+ fabric options'],
  },
  slimmarco: {
    name: 'Slim Marco Sofa',
    price: 'From ¬£1,420',
    url: 'https://www.sofa.com/gb/spring-summer-2026/slim-marco-sofa/p/SO-SMR',
    description: 'The iconic Marco reimagined with a slimmer, sleeker silhouette. New for Spring/Summer 2026 with 100+ fabrics and custom sizing options.',
    key_features: ['New for Spring/Summer 2026','Slim contemporary profile','Based on the iconic Marco design','100+ fabric options','Custom sizes available']
  }
};

function showFeatured(id) {
  const p = featuredData[id];
  if (!p) return;
  document.getElementById('modalProductName').textContent = p.name;
  let body = `
    <p style="font-size:22px;color:var(--gold);font-family:'DM Serif Display',serif;margin:0 0 12px">${escHtml(p.price)}</p>
    <p>${escHtml(p.description)}</p>
    <div style="height:1px;background:var(--border);margin:16px 0"></div>`;
  if (p.key_features?.length) {
    body += `<p><strong>Key Features</strong></p><ul>`;
    p.key_features.forEach(f => body += `<li>${escHtml(f)}</li>`);
    body += `</ul>`;
  }
  if (p.note) {
    body += `<p style="margin-top:14px;font-size:12.5px;color:var(--text-muted);font-style:italic">${escHtml(p.note)}</p>`;
  }
  body += `<div style="margin-top:18px"><a href="${escHtml(p.url)}" target="_blank" style="display:inline-flex;align-items:center;gap:6px;background:var(--gold);color:#0f0f10;padding:10px 20px;border-radius:8px;text-decoration:none;font-weight:600;font-size:13px">View on sofa.com ‚Üó</a></div>`;
  body += `<div style="height:1px;background:var(--border);margin:16px 0"></div>
    <p style="font-size:12px;color:var(--text-muted)">‚úÖ Lifetime frame guarantee &nbsp;‚Ä¢&nbsp; üöö White-glove delivery (~¬£149) &nbsp;‚Ä¢&nbsp; üé® Free swatches (up to 6)</p>`;
  document.getElementById('modalProductBody').innerHTML = body;
  document.getElementById('productModal').classList.add('open');
}

function showProduct(idx) {
  const p = catalog.products[idx];
  if (!p) return;
  document.getElementById('modalProductName').textContent = p.name;
  let body = `
    <p style="font-size:22px;color:var(--gold);font-family:'DM Serif Display',serif;margin:0 0 4px">${escHtml(p.starting_price)}</p>
    ${isModular(p) ? `<p style="font-size:11.5px;color:var(--text-muted);margin:0 0 14px;font-style:italic">*Price shown is per single module ‚Äî full configurations will vary</p>` : '<div style="margin-bottom:14px"></div>'}
    <p>${escHtml(p.description||'Handmade bespoke sofa. 100+ fabric options.')}</p>
    <div style="height:1px;background:var(--border);margin:16px 0"></div>`;
  if (p.key_features?.length) {
    body += `<p><strong>Key Features</strong></p><ul>`;
    p.key_features.forEach(f => body += `<li>${escHtml(f)}</li>`);
    body += `</ul>`;
  }
  if (p.variants?.length) {
    body += `<p style="margin-top:14px"><strong>Configurations:</strong></p><p>`;
    p.variants.forEach(v => body += `<span class="product-tag">${escHtml(v)}</span>`);
    body += `</p>`;
  }
  if (p.url) {
    body += `<div style="margin-top:18px"><a href="${escHtml(p.url)}" target="_blank" style="display:inline-flex;align-items:center;gap:6px;background:var(--gold);color:#0f0f10;padding:10px 20px;border-radius:8px;text-decoration:none;font-weight:600;font-size:13px">View on sofa.com ‚Üó</a></div>`;
  }
  body += `<div style="height:1px;background:var(--border);margin:16px 0"></div>
    <p style="font-size:12px;color:var(--text-muted)">‚úÖ Lifetime frame guarantee &nbsp;‚Ä¢&nbsp; üöö White-glove delivery (~¬£149) &nbsp;‚Ä¢&nbsp; üé® Free swatches (up to 6) &nbsp;‚Ä¢&nbsp; ‚è± 4‚Äì6 weeks</p>`;
  document.getElementById('modalProductBody').innerHTML = body;
  document.getElementById('productModal').classList.add('open');
}

/* ‚îÄ‚îÄ‚îÄ GROQ ‚îÄ‚îÄ‚îÄ */
function buildSystemPrompt() {
  const prodList = catalog.products.map(p =>
    `- ${p.name} | ${p.category} | ${p.starting_price} | ${p.description||''}${p.key_features?.length ? ' | '+p.key_features.join('; ') : ''}`
  ).join('\n');

  const fabricList = catalog.fabrics.map(g =>
    `${g.group}: ${g.examples.join(', ')}`
  ).join('\n');

  return `You are a warm, knowledgeable sofa advisor for sofa.com. Help customers find their perfect sofa.

CATALOG (${catalog.products.length} products):
${prodList}

FABRICS (100+ options, up to 6 free swatches):
${fabricList}

KEY FACTS:
- All sofas are bespoke handmade in the UK
- Lifetime frame guarantee on all models
- White-glove delivery ~¬£149 UK mainland, 4‚Äì6 weeks lead time
- Customer's Own Material (COM) accepted
- Breakdown options on some models for narrow hallways

INSTRUCTIONS:
- Be warm, concise, and conversational. No waffle.
- Format with simple HTML only: <p>, <strong>, <em>, <ul>, <li>. No markdown.
- When recommending products, append this tag at the very end: <!--PRODUCTS:Exact Product Name,Another Name-->
- Only use exact product names from the catalog above.
- For budget queries, only recommend products within budget.`;
}

async function callGroq(userMessage) {
  chatHistory.push({role:'user', content:userMessage});

  const res = await fetch('https://api.groq.com/openai/v1/chat/completions', {
    method:'POST',
    headers:{'Content-Type':'application/json','Authorization':`Bearer ${groqApiKey}`},
    body:JSON.stringify({
      model:'llama-3.3-70b-versatile',
      messages:[{role:'system',content:buildSystemPrompt()}, ...chatHistory],
      temperature:0.7,
      max_tokens:1024
    })
  });

  if (!res.ok) {
    if (res.status === 401) { groqApiKey=''; localStorage.removeItem('groqApiKey'); showApiKeyModal(); return null; }
    const e = await res.json().catch(()=>({error:{message:`HTTP ${res.status}`}}));
    throw new Error(e.error?.message || `HTTP ${res.status}`);
  }

  const data = await res.json();
  const text = data.choices[0].message.content;
  chatHistory.push({role:'assistant', content:text});
  return text;
}

function parseAIResponse(raw) {
  const m = raw.match(/<!--PRODUCTS:(.*?)-->/);
  let html = raw.replace(/<!--PRODUCTS:.*?-->/g,'').trim();
  if (m) {
    m[1].split(',').map(s=>s.trim()).forEach(name => {
      const p = catalog.products.find(p => p.name.toLowerCase()===name.toLowerCase());
      if (p) html += productCard(p);
    });
  }
  return html;
}

async function sendMessage() {
  const input = document.getElementById('chatInput');
  const text = input.value.trim();
  if (!text) return;

  if (!groqApiKey) { showApiKeyModal(); return; }

  input.value = '';
  input.disabled = true;
  document.getElementById('sendBtn').disabled = true;

  addMessage('user', escHtml(text));
  showTyping();

  try {
    const raw = await callGroq(text);
    removeTyping();
    if (raw) addMessage('bot', parseAIResponse(raw));
  } catch(err) {
    removeTyping();
    addMessage('bot', `<p>‚ö†Ô∏è <strong>Error:</strong> ${escHtml(err.message)}</p><p>Check your API key and try again.</p>`);
  }

  input.disabled = false;
  document.getElementById('sendBtn').disabled = false;
  input.focus();
}

/* ‚îÄ‚îÄ‚îÄ API KEY MODAL ‚îÄ‚îÄ‚îÄ */
function showApiKeyModal() {
  document.getElementById('apiKeyInput').value = groqApiKey || '';
  document.getElementById('apiKeyModal').classList.add('open');
  setTimeout(() => document.getElementById('apiKeyInput').focus(), 100);
}

function saveApiKey() {
  const key = document.getElementById('apiKeyInput').value.trim();
  if (!key) return;
  groqApiKey = key;
  localStorage.setItem('groqApiKey', key);
  document.getElementById('apiKeyModal').classList.remove('open');
  chatHistory = [];
  addMessage('bot', `‚úÖ Connected to <strong>Llama 3.3 70B via Groq</strong>. Ask me anything ‚Äî budgets, sofa types, fabrics, room sizes, all of it.`);
}

/* ‚îÄ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ */
window.onload = function() {
  document.getElementById('sendBtn').addEventListener('click', sendMessage);
  document.getElementById('chatInput').addEventListener('keypress', e => { if (e.key==='Enter') sendMessage(); });

  document.getElementById('closeModalBtn').addEventListener('click', () => document.getElementById('productModal').classList.remove('open'));
  document.getElementById('productModal').addEventListener('click', e => { if (e.target.id==='productModal') e.target.classList.remove('open'); });
  document.getElementById('messages').addEventListener('click', e => {
    const card = e.target.closest('.mini-product');
    if (card) showProduct(parseInt(card.dataset.index, 10));
  });

  document.getElementById('connectAiBtn').addEventListener('click', showApiKeyModal);
  document.getElementById('closeApiKeyBtn').addEventListener('click', () => document.getElementById('apiKeyModal').classList.remove('open'));
  document.getElementById('apiKeyModal').addEventListener('click', e => { if (e.target.id==='apiKeyModal') e.target.classList.remove('open'); });
  document.getElementById('saveApiKeyBtn').addEventListener('click', saveApiKey);
  document.getElementById('apiKeyInput').addEventListener('keypress', e => { if (e.key==='Enter') saveApiKey(); });

  const aiStatus = groqApiKey
    ? `Connected to <strong>Llama 3.3 70B via Groq</strong> ‚Äî ask me anything.`
    : `Click <strong>ü§ñ Connect AI</strong> in the top right to get started.`;

  addMessage('bot', `Hi Jordan üëã I'm your <strong>Sofa Concierge</strong> ‚Äî ${catalog.products.length} real sofa.com products loaded.<br><br>${aiStatus}<br><br>Try: <em>"corner sofa under ¬£3000"</em>, <em>"I need a sofa bed for guests"</em>, or <em>"what fabrics do you have?"</em>`);

  if (!groqApiKey) setTimeout(showApiKeyModal, 700);
  document.getElementById('chatInput').focus();
};
</script>

</body>
</html>