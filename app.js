/* â”€â”€â”€ CATALOG DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
var products = [
{
id: 1, icon: â€˜ğŸ›‹ï¸â€™,
name: â€˜Slim Marco Sofaâ€™,
tags: [â€˜Contemporaryâ€™, â€˜Compactâ€™],
desc: â€˜Slim arms and a deep seat â€” a modern classic that suits smaller spaces perfectly.â€™,
seats: â€˜2â€“3 Seaterâ€™, style: â€˜Contemporaryâ€™, bestFor: â€˜Couples, smaller roomsâ€™, fabric: â€˜Fabric & leatherâ€™,
points: [
â€˜Slim arm profile keeps it light and open â€” great if space is tightâ€™,
â€˜Deep seat cushions give surprising comfort for the slim frameâ€™,
â€˜Works in rooms where a chunky sofa would feel overwhelmingâ€™,
â€˜Popular with young couples who want modern without going too minimalâ€™
]
},
{
id: 2, icon: â€˜ğŸ”²â€™,
name: â€˜Cohen Modular Sofaâ€™,
tags: [â€˜Contemporaryâ€™, â€˜Modularâ€™, â€˜Familyâ€™],
desc: â€˜Fully modular â€” build the layout that suits the room, and change it any time.â€™,
seats: â€˜3â€“6+ Seaterâ€™, style: â€˜Contemporaryâ€™, bestFor: â€˜Families, open-plan roomsâ€™, fabric: â€˜Wide fabric rangeâ€™,
points: [
â€˜Fully modular â€” rearrange or add sections whenever they wantâ€™,
â€˜Best option for customers who aren't sure how the room will evolveâ€™,
â€˜Great for large open-plan living and dining spacesâ€™,
â€˜Consistent bestseller â€” easy to upsell with extra modulesâ€™
]
},
{
id: 3, icon: â€˜ğŸŒ¸â€™,
name: â€˜Bluebell Sofaâ€™,
tags: [â€˜Traditionalâ€™, â€˜Chicâ€™],
desc: â€˜Elegant pleated arms and classic proportions â€” timeless British character.â€™,
seats: â€˜2â€“4 Seaterâ€™, style: â€˜Traditionalâ€™, bestFor: â€˜Traditional homes, couplesâ€™, fabric: â€˜Fabric & velvetâ€™,
points: [
â€˜Pleated arms are the signature detail â€” customers notice immediatelyâ€™,
â€˜Classic silhouette appeals strongly to traditional tasteâ€™,
â€˜Velvet options are a very easy upsell â€” they love the touchâ€™,
â€˜Strong margin product â€” worth leading with for heritage-focused customersâ€™
]
},
{
id: 4, icon: â€˜ğŸ§¸â€™,
name: â€˜Teddy Sofaâ€™,
tags: [â€˜Familyâ€™, â€˜Comfortâ€™],
desc: â€˜Extra-deep seat and bouclÃ© fabric options â€” the ultimate family lounge sofa.â€™,
seats: â€˜3â€“4 Seaterâ€™, style: â€˜Relaxedâ€™, bestFor: â€˜Families, movie nightsâ€™, fabric: â€˜BouclÃ© & fabricâ€™,
points: [
â€˜Extra-deep seat â€” made specifically for lounging and unwindingâ€™,
â€˜BouclÃ© fabric is a current bestseller and a very easy sellâ€™,
â€˜Extremely durable â€” handles kids and pets wellâ€™,
â€˜One of the strongest word-of-mouth products in the whole rangeâ€™
]
},
{
id: 5, icon: â€˜â†—ï¸â€™,
name: â€˜Holly Chaise Sofaâ€™,
tags: [â€˜Familyâ€™, â€˜Comfortâ€™],
desc: â€˜Sofa with integrated chaise â€” brilliant use of a corner or side wall.â€™,
seats: â€˜3 Seat + Chaiseâ€™, style: â€˜Relaxedâ€™, bestFor: â€˜TV rooms, familiesâ€™, fabric: â€˜Fabric optionsâ€™,
points: [
â€˜Chaise makes brilliant use of corner or side-wall spaceâ€™,
â€˜Very popular with customers who specifically say â€œput my feet upâ€â€™,
â€˜Available left or right chaise configurationâ€™,
â€˜Great entry point for customers who are curious about corner sofasâ€™
]
},
{
id: 6, icon: â€˜âŒâ€™,
name: â€˜Izzy Corner Sofaâ€™,
tags: [â€˜Familyâ€™, â€˜Modularâ€™],
desc: â€˜Spacious L-shape corner arrangement â€” seats the whole family comfortably.â€™,
seats: â€˜5â€“6 Seaterâ€™, style: â€˜Contemporaryâ€™, bestFor: â€˜Large families, big roomsâ€™, fabric: â€˜Fabric & leatherâ€™,
points: [
â€˜Large L-shape fills a living room beautifully without feeling forcedâ€™,
â€˜Seats 5â€“6 comfortably â€” ideal for large family householdsâ€™,
â€˜Clean lines keep it feeling modern, not bulkyâ€™,
â€˜High-value item â€” excellent for strong daily sales figuresâ€™
]
},
{
id: 7, icon: â€˜â­â€™,
name: â€˜Stellar Armchairâ€™,
tags: [â€˜Contemporaryâ€™, â€˜Chicâ€™],
desc: â€˜Statement modern armchair â€” works as a standalone piece or alongside a sofa.â€™,
seats: â€˜1 Seaterâ€™, style: â€˜Contemporaryâ€™, bestFor: â€˜Add-on sale, reading cornerâ€™, fabric: â€˜Fabric & leatherâ€™,
points: [
â€˜Excellent add-on sale alongside almost any sofa in the rangeâ€™,
â€˜Strong standalone statement â€” customers who want a reading corner love itâ€™,
â€˜Geometric silhouette photographs beautifully â€” common on mood boardsâ€™,
â€˜Fabric upgrades are a natural upsell on this oneâ€™
]
},
{
id: 8, icon: â€˜ğŸŒ™â€™,
name: â€˜Luna Corner Sofaâ€™,
tags: [â€˜Familyâ€™, â€˜Comfortâ€™],
desc: â€˜Generous L-shape with deep cushioning throughout â€” the ultimate family sofa.â€™,
seats: â€˜5+ Seaterâ€™, style: â€˜Relaxedâ€™, bestFor: â€˜Large families, spacious roomsâ€™, fabric: â€˜Fabric optionsâ€™,
points: [
â€˜Very deep, generous cushioning â€” immediately obvious when customers sit downâ€™,
â€˜Popular for larger rooms where customers want the sofa to fill the spaceâ€™,
â€˜Subtle rounded corners soften the look â€” less imposing than sharper cornersâ€™,
â€˜Consistently strong seller â€” a dependable recommendation for big roomsâ€™
]
},
{
id: 9, icon: â€˜ğŸª‘â€™,
name: â€˜Marco Armchairâ€™,
tags: [â€˜Contemporaryâ€™, â€˜Compactâ€™],
desc: â€˜Matching slim armchair to the Marco Sofa â€” perfect pair or standalone accent.â€™,
seats: â€˜1 Seaterâ€™, style: â€˜Contemporaryâ€™, bestFor: â€˜Pairing with Marco Sofaâ€™, fabric: â€˜Fabric & leatherâ€™,
points: [
â€˜Natural upsell for anyone buying or interested in the Slim Marco Sofaâ€™,
â€˜Works equally well as a standalone accent chair in a bedroom or studyâ€™,
â€˜Slim profile means it doesn't eat into the roomâ€™,
â€˜Matching pair creates a very cohesive, designed lookâ€™
]
},
{
id: 10, icon: â€˜ğŸ©â€™,
name: â€˜Chester Sofaâ€™,
tags: [â€˜Traditionalâ€™, â€˜Chicâ€™],
desc: â€˜Timeless rolled arms and classic silhouette â€” refined traditional comfort.â€™,
seats: â€˜2â€“4 Seaterâ€™, style: â€˜Traditionalâ€™, bestFor: â€˜Period homes, traditionalistsâ€™, fabric: â€˜Fabric & velvetâ€™,
points: [
â€˜Classic rolled arm is immediately recognisable and reassuring to traditional buyersâ€™,
â€˜Sits very well in period properties and homes with original featuresâ€™,
â€˜Velvet finish options are exceptionally popularâ€™,
â€˜Appeals to customers who describe wanting â€œsomething classic and elegantâ€â€™
]
},
{
id: 11, icon: â€˜ğŸ’œâ€™,
name: â€˜Oscar Velvet Chairâ€™,
tags: [â€˜Luxuryâ€™, â€˜Chicâ€™],
desc: â€˜Plush velvet accent chair â€” a statement piece that elevates any room.â€™,
seats: â€˜1 Seaterâ€™, style: â€˜Luxuryâ€™, bestFor: â€˜Accent piece, bedroom, studyâ€™, fabric: â€˜Velvet onlyâ€™,
points: [
â€˜Velvet finish is the entire appeal â€” let them touch it immediatelyâ€™,
â€˜Excellent bedroom or home office statement pieceâ€™,
â€˜Works as a strong add-on alongside a sofa purchaseâ€™,
â€˜Premium feel at an accessible price â€” easy conversation starterâ€™
]
},
{
id: 12, icon: â€˜ğŸ”µâ€™,
name: â€˜Baylee 3-Seaterâ€™,
tags: [â€˜Contemporaryâ€™, â€˜Comfortâ€™],
desc: â€˜Low back, relaxed silhouette â€” laid-back modern comfort.â€™,
seats: â€˜3 Seaterâ€™, style: â€˜Contemporaryâ€™, bestFor: â€˜Young couples, media roomsâ€™, fabric: â€˜Wide fabric rangeâ€™,
points: [
â€˜Low back gives a very open, relaxed feel â€” popular for media roomsâ€™,
â€˜Sits well under a window without blocking lightâ€™,
â€˜Casual but stylish â€” works for customers who don't want anything too formalâ€™,
â€˜Fabric range is broad â€” good for customers who have a specific colour in mindâ€™
]
},
{
id: 13, icon: â€˜ğŸ›ï¸â€™,
name: â€˜Classic Chesterfieldâ€™,
tags: [â€˜Traditionalâ€™, â€˜Luxuryâ€™],
desc: â€˜Iconic deep-buttoned Chesterfield â€” the definitive traditional statement sofa.â€™,
seats: â€˜2â€“4 Seaterâ€™, style: â€˜Traditional Luxuryâ€™, bestFor: â€˜Heritage homes, statement roomsâ€™, fabric: â€˜Leather & velvetâ€™,
points: [
â€˜The Chesterfield is the most recognisable sofa silhouette in British designâ€™,
â€˜Deep button detail is immediately impressive in personâ€™,
â€˜Leather options age beautifully â€” strong selling point for long-term buyersâ€™,
â€˜Premium price point â€” position as an investment, not a purchaseâ€™
]
},
{
id: 14, icon: â€˜ğŸŸ«â€™,
name: â€˜Jasper Modular Cornerâ€™,
tags: [â€˜Modularâ€™, â€˜Familyâ€™],
desc: â€˜Versatile modular corner â€” configure it for the room, reconfigure it for the next one.â€™,
seats: â€˜4â€“7 Seaterâ€™, style: â€˜Contemporaryâ€™, bestFor: â€˜Flexible spaces, growing familiesâ€™, fabric: â€˜Wide fabric rangeâ€™,
points: [
â€˜More corner options than the Cohen â€” better for customers wanting a very specific configurationâ€™,
â€˜Works in oddly shaped rooms that standard sofas don't suitâ€™,
â€˜Strong option for customers who mention they might be moving houseâ€™,
â€˜Kids and teens love the flexibility â€” a family sofa that moves with themâ€™
]
},
{
id: 15, icon: â€˜ğŸ’â€™,
name: â€˜Florence 2-Seaterâ€™,
tags: [â€˜Contemporaryâ€™, â€˜Compactâ€™],
desc: â€˜Compact, cosy and beautifully proportioned â€” perfect for smaller living rooms.â€™,
seats: â€˜2 Seaterâ€™, style: â€˜Contemporaryâ€™, bestFor: â€˜Small spaces, apartmentsâ€™, fabric: â€˜Fabric & leatherâ€™,
points: [
â€˜Best compact sofa in the range â€” proportions are excellentâ€™,
â€˜Popular with city apartment buyers and first-home customersâ€™,
â€˜Doesn't feel like a compromise â€” looks intentional and consideredâ€™,
â€˜Pair with the Marco Armchair for a full seating arrangement without the bulkâ€™
]
},
{
id: 16, icon: â€˜âš¡â€™,
name: â€˜Hugo Recliner Sofaâ€™,
tags: [â€˜Familyâ€™, â€˜Comfortâ€™],
desc: â€˜Power recliner with USB charging built in â€” comfort meets practicality.â€™,
seats: â€˜3â€“4 Seaterâ€™, style: â€˜Relaxedâ€™, bestFor: â€˜Families, tech lovers, TV roomsâ€™, fabric: â€˜Fabric & leatherâ€™,
points: [
â€˜Power recliner is the first thing customers want to try â€” let themâ€™,
â€˜USB charging built in â€” a feature that always gets a positive reactionâ€™,
â€˜Leather option is popular for easy-clean on a reclinerâ€™,
â€˜Excellent for customers who specifically mention watching TV or gamingâ€™
]
},
{
id: 17, icon: â€˜ğŸŒ¿â€™,
name: â€˜Eden Fabric Sofaâ€™,
tags: [â€˜Contemporaryâ€™, â€˜Comfortâ€™],
desc: â€˜Scandi-inspired clean lines â€” relaxed, refined, effortlessly casual.â€™,
seats: â€˜2â€“4 Seaterâ€™, style: â€˜Scandi / Contemporaryâ€™, bestFor: â€˜Minimal interiors, natural tonesâ€™, fabric: â€˜Fabric â€” natural tonesâ€™,
points: [
â€˜The Scandi look appeals strongly to customers who mention Pinterest or interior blogsâ€™,
â€˜Natural tone fabric range is a key differentiator â€” earthy, warm, consideredâ€™,
â€˜Clean lines mean it photographs brilliantly â€” very shareableâ€™,
â€˜Works in rooms with lots of wood, plants or natural materialsâ€™
]
},
{
id: 18, icon: â€˜ğŸŸ¤â€™,
name: â€˜Monty Leather Sofaâ€™,
tags: [â€˜Traditionalâ€™, â€˜Luxuryâ€™],
desc: â€˜Premium leather with a beautifully aged character â€” built to last a lifetime.â€™,
seats: â€˜2â€“4 Seaterâ€™, style: â€˜Traditionalâ€™, bestFor: â€˜Leather buyers, long-term investmentâ€™, fabric: â€˜Full-grain leatherâ€™,
points: [
â€˜Full-grain leather develops a patina over time â€” unique to each sofaâ€™,
â€˜Best option for customers who have had leather before and loved itâ€™,
â€˜Easy to clean â€” always worth mentioning for households with kids or petsâ€™,
â€˜Positions as a lifetime investment â€” premium but aspirationalâ€™
]
},
{
id: 19, icon: â€˜ğŸ”·â€™,
name: â€˜Nova Corner Sofaâ€™,
tags: [â€˜Familyâ€™, â€˜Modularâ€™],
desc: â€˜Modern corner with an integrated chaise option â€” spacious and stylish.â€™,
seats: â€˜5â€“6 Seaterâ€™, style: â€˜Contemporaryâ€™, bestFor: â€˜Large family rooms, modern interiorsâ€™, fabric: â€˜Fabric rangeâ€™,
points: [
â€˜Combines the corner sofa shape with a chaise option â€” maximum versatilityâ€™,
â€˜Cleaner and more contemporary than the Luna â€” appeals to modern buyersâ€™,
â€˜Good for customers who want family-sized but don't want a traditional lookâ€™,
â€˜Configurable layout means it suits a wide range of room shapesâ€™
]
},
{
id: 20, icon: â€˜ğŸŒŠâ€™,
name: â€˜Sienna 3-Seaterâ€™,
tags: [â€˜Contemporaryâ€™, â€˜Chicâ€™],
desc: â€˜Low profile, wide silhouette â€” the sofa that looks like it belongs in a magazine.â€™,
seats: â€˜3 Seaterâ€™, style: â€˜Contemporaryâ€™, bestFor: â€˜Style-conscious buyers, open spacesâ€™, fabric: â€˜Wide fabric rangeâ€™,
points: [
â€˜Very strong kerb appeal â€” customers stop in front of this oneâ€™,
â€˜Low, wide profile suits high ceilings and open-plan spaces particularly wellâ€™,
â€˜Bold fabric choices suit it â€” worth pushing the customer on colour hereâ€™,
â€˜Tends to attract customers who mention design, interiors or architectureâ€™
]
}
];

/* â”€â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
var featuredId    = parseInt(localStorage.getItem(â€˜sofa_featuredâ€™) || â€˜2â€™, 10);
var selectedId    = null;
var activeTags    = [];
var chatHistory   = [];
var provider      = localStorage.getItem(â€˜sofa_providerâ€™) || â€˜groqâ€™;
var apiKey        = localStorage.getItem(â€˜sofa_ai_keyâ€™)   || â€˜â€™;
var currentPage   = â€˜catalogâ€™;

/* â”€â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
window.onload = function() {
renderFeatured();
renderStyleFilters();
applyFilters();
renderQuickAsk();
populateFeaturedSelect();
updateSettingsUI();
showPage(â€˜catalogâ€™);

document.addEventListener(â€˜keydownâ€™, function(e) {
if ((e.ctrlKey || e.metaKey) && e.key === â€˜Enterâ€™) {
if (currentPage === â€˜advisorâ€™) sendChat();
}
});

setTimeout(function() {
addMsg(â€˜assistantâ€™,
â€™Hi Jordan! I'm your AI sofa sales advisor â€” powered by â€™ +
(provider === â€˜groqâ€™ ? â€˜Llama 3.1 70B on Groqâ€™ : â€˜GPT-4o Miniâ€™) + â€˜.\n\nâ€™ +
â€˜Describe a customer to me â€” their room, lifestyle, style, budget â€” and I'll tell you exactly which sofa to show them and how to sell it.â€™
);
}, 400);
};

/* â”€â”€â”€ PAGE NAV â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function showPage(page) {
currentPage = page;
var pages = [â€˜catalogâ€™, â€˜advisorâ€™, â€˜settingsâ€™];
pages.forEach(function(p) {
var el = document.getElementById(â€˜pageâ€™ + cap(p));
if (el) el.classList.toggle(â€˜hiddenâ€™, p !== page);
var btn = document.getElementById(â€˜navâ€™ + cap(p));
if (btn) btn.classList.toggle(â€˜activeâ€™, p === page);
});
}

function cap(s) { return s.charAt(0).toUpperCase() + s.slice(1); }

/* â”€â”€â”€ FEATURED HERO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function renderFeatured() {
var p  = products.find(function(x) { return x.id === featuredId; });
var el = document.getElementById(â€˜featuredHeroâ€™);
if (!p || !el) return;

el.innerHTML =
â€˜<span class="featured-badge">â­ Featured This Week</span>â€™ +
â€˜<div class="featured-name">â€™ + p.name + â€˜</div>â€™ +
â€˜<div class="featured-desc">â€™ + p.desc + â€˜</div>â€™ +
â€˜<div class="featured-meta">â€™ +
p.tags.map(function(t) { return â€˜<span class="tag-pill">â€™ + t + â€˜</span>â€™; }).join(â€™â€™) +
â€˜</div>â€™ +
â€˜<div class="featured-specs">â€™ +
mkSpec(â€˜Seatsâ€™, p.seats) +
mkSpec(â€˜Styleâ€™, p.style) +
mkSpec(â€˜Best Forâ€™, p.bestFor) +
â€˜</div>â€™ +
â€˜<button class="btn btn-primary" onclick="askSofa(' + p.id + ')" style="width:100%;justify-content:center;">â€™ +
â€˜ğŸ¤– Ask AI about this sofaâ€™ +
â€˜</button>â€™;
}

function mkSpec(label, val) {
return â€˜<div class="spec-block"><div class="spec-label">â€™ + label + â€˜</div><div class="spec-value">â€™ + val + â€˜</div></div>â€™;
}

/* â”€â”€â”€ STYLE FILTER CHIPS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function renderStyleFilters() {
var all = [];
products.forEach(function(p) {
p.tags.forEach(function(t) { if (all.indexOf(t) === -1) all.push(t); });
});

var container = document.getElementById(â€˜styleFiltersâ€™);
container.innerHTML = all.map(function(tag) {
return â€˜<button class="style-chip" onclick="toggleTag(\'' + tag + '\', this)">â€™ + tag + â€˜</button>â€™;
}).join(â€™â€™);
}

function toggleTag(tag, btn) {
var i = activeTags.indexOf(tag);
if (i === -1) { activeTags.push(tag); btn.classList.add(â€˜onâ€™); }
else           { activeTags.splice(i, 1); btn.classList.remove(â€˜onâ€™); }
applyFilters();
updateClearBtn();
}

function clearFilters() {
activeTags = [];
document.querySelectorAll(â€™.style-chipâ€™).forEach(function(c) { c.classList.remove(â€˜onâ€™); });
document.getElementById(â€˜catalogSearchâ€™).value = â€˜â€™;
applyFilters();
updateClearBtn();
}

function updateClearBtn() {
var btn   = document.getElementById(â€˜clearFiltersBtnâ€™);
var term  = document.getElementById(â€˜catalogSearchâ€™).value;
var show  = activeTags.length > 0 || term.length > 0;
btn.style.display = show ? â€˜blockâ€™ : â€˜noneâ€™;
}

/* â”€â”€â”€ FILTER + RENDER CATALOG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function applyFilters() {
var term = (document.getElementById(â€˜catalogSearchâ€™).value || â€˜â€™).toLowerCase().trim();
updateClearBtn();

var list = products.filter(function(p) {
var matchName = p.name.toLowerCase().indexOf(term) !== -1;
var matchDesc = p.desc.toLowerCase().indexOf(term) !== -1;
var matchSearch = term === â€˜â€™ || matchName || matchDesc;
var matchTags = activeTags.length === 0 ||
activeTags.every(function(t) { return p.tags.indexOf(t) !== -1; });
return matchSearch && matchTags;
});

var label = document.getElementById(â€˜resultsLabelâ€™);
label.textContent = list.length + â€™ sofaâ€™ + (list.length !== 1 ? â€˜sâ€™ : â€˜â€™);

renderCatalog(list);
}

function renderCatalog(list) {
var grid = document.getElementById(â€˜catalogGridâ€™);
grid.innerHTML = â€˜â€™;

if (list.length === 0) {
grid.innerHTML = â€˜<div class="catalog-empty">No sofas match those filters.<br>Try clearing the search or adjusting the tags.</div>â€™;
return;
}

list.forEach(function(p) {
var card = document.createElement(â€˜divâ€™);
card.className = â€˜sofa-cardâ€™ + (p.id === selectedId ? â€™ selectedâ€™ : â€˜â€™);
card.setAttribute(â€˜data-idâ€™, String(p.id));
card.innerHTML =
â€˜<span class="sofa-icon">â€™ + p.icon + â€˜</span>â€™ +
â€˜<div class="sofa-name">â€™ + p.name + â€˜</div>â€™ +
â€˜<div class="sofa-desc">â€™ + p.desc + â€˜</div>â€™ +
â€˜<div class="sofa-tags">â€™ +
p.tags.map(function(t) { return â€˜<span class="sofa-tag">â€™ + t + â€˜</span>â€™; }).join(â€™â€™) +
â€˜</div>â€™;
card.addEventListener(â€˜clickâ€™, function() { selectSofa(p.id); });
grid.appendChild(card);
});
}

/* â”€â”€â”€ SOFA SELECTION + DETAIL PANEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function selectSofa(id) {
selectedId = id;
document.querySelectorAll(â€™.sofa-cardâ€™).forEach(function(c) {
c.classList.toggle(â€˜selectedâ€™, parseInt(c.getAttribute(â€˜data-idâ€™), 10) === id);
});
var p = products.find(function(x) { return x.id === id; });
renderDetailPanel(p);
}

function renderDetailPanel(p) {
var el = document.getElementById(â€˜detailPanelâ€™);

var tagsHtml = p.tags.map(function(t) {
return â€˜<span class="tag-pill">â€™ + t + â€˜</span>â€™;
}).join(â€™â€™);

var specsHtml =
â€˜<div class="detail-specs">â€™ +
mkDetailSpec(â€˜Seatsâ€™, p.seats) +
mkDetailSpec(â€˜Styleâ€™, p.style) +
mkDetailSpec(â€˜Best Forâ€™, p.bestFor) +
mkDetailSpec(â€˜Fabricâ€™, p.fabric) +
â€˜</div>â€™;

var pointsHtml = p.points.map(function(pt) {
return â€˜<div class="detail-point"><div class="point-dot"></div><span>â€™ + pt + â€˜</span></div>â€™;
}).join(â€™â€™);

el.innerHTML =
â€˜<span class="detail-icon">â€™ + p.icon + â€˜</span>â€™ +
â€˜<div class="detail-name">â€™ + p.name + â€˜</div>â€™ +
â€˜<div class="detail-desc">â€™ + p.desc + â€˜</div>â€™ +
â€˜<div class="detail-tags">â€™ + tagsHtml + â€˜</div>â€™ +
specsHtml +
â€˜<div class="detail-points-label">Selling Points</div>â€™ +
â€˜<div>â€™ + pointsHtml + â€˜</div>â€™ +
â€˜<button class="btn btn-success detail-ask-btn" onclick="askSofa(' + p.id + ')">â€™ +
â€˜ğŸ¤– Ask AI about this sofaâ€™ +
â€˜</button>â€™;
}

function mkDetailSpec(label, val) {
return â€˜<div class="detail-spec">â€™ +
â€˜<div class="detail-spec-label">â€™ + label + â€˜</div>â€™ +
â€˜<div class="detail-spec-value">â€™ + val + â€˜</div>â€™ +
â€˜</div>â€™;
}

/* â”€â”€â”€ QUICK ASK LIST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function renderQuickAsk() {
var list = document.getElementById(â€˜quickAskListâ€™);
if (!list) return;
list.innerHTML = products.slice(0, 10).map(function(p) {
return â€˜<button class="quick-ask-btn" onclick="askSofa(' + p.id + ')">â€™ +
â€˜<span class="qa-icon">â€™ + p.icon + â€˜</span>â€™ +
â€˜<div>â€™ +
â€˜<div class="qa-text">â€™ + p.name + â€˜</div>â€™ +
â€˜<div class="qa-tags">â€™ + p.tags.join(â€™ Â· â€˜) + â€˜</div>â€™ +
â€˜</div>â€™ +
â€˜</button>â€™;
}).join(â€™â€™);
}

/* â”€â”€â”€ AI CHAT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function askSofa(id) {
var p = products.find(function(x) { return x.id === id; });
showPage(â€˜advisorâ€™);
document.getElementById(â€˜chatInputâ€™).value =
â€˜Tell me about the â€™ + p.name + â€™ â€” who is it perfect for, key selling points, and what fabrics would you recommend?â€™;
sendChat();
}

function sendChat() {
var input = document.getElementById(â€˜chatInputâ€™);
var msg   = input.value.trim();
if (!msg) return;

if (!apiKey) {
showPage(â€˜settingsâ€™);
return;
}

var sendBtn = document.getElementById(â€˜sendBtnâ€™);
sendBtn.disabled = true;
sendBtn.textContent = â€˜Sendingâ€¦â€™;

addMsg(â€˜userâ€™, msg);
input.value = â€˜â€™;

var thinkEl = addMsg(â€˜thinkingâ€™, â€˜Thinkingâ€¦â€™);

var url   = provider === â€˜groqâ€™
? â€˜https://api.groq.com/openai/v1/chat/completionsâ€™
: â€˜https://api.openai.com/v1/chat/completionsâ€™;

var model = provider === â€˜groqâ€™ ? â€˜llama-3.1-70b-versatileâ€™ : â€˜gpt-4o-miniâ€™;

var systemMsg =
â€™You are an expert sofa sales advisor helping Jordan, a sales associate at Sofa.com. â€™ +
â€™Jordan is on the shop floor and needs quick, practical advice to close a sale. â€™ +
â€™You have full knowledge of this product catalog: â€™ + JSON.stringify(products) + â€™. â€™ +
â€™When recommending, be specific: name the sofa, explain exactly why it suits the customer described, â€™ +
â€™suggest a fabric or colour direction, and include one upsell opportunity. â€™ +
â€™Keep responses concise â€” Jordan needs to relay this to a live customer. No waffle. â€™ +
â€˜If asked about a specific sofa, give Jordan the key selling points and who to pitch it to.â€™;

var messages = [{ role: â€˜systemâ€™, content: systemMsg }];
chatHistory.forEach(function(m) { messages.push(m); });
messages.push({ role: â€˜userâ€™, content: msg });

fetch(url, {
method: â€˜POSTâ€™,
headers: {
â€˜Content-Typeâ€™: â€˜application/jsonâ€™,
â€˜Authorizationâ€™: â€™Bearer â€™ + apiKey
},
body: JSON.stringify({ model: model, messages: messages, max_tokens: 500 })
})
.then(function(res) { return res.json(); })
.then(function(data) {
thinkEl.remove();
var reply = (data.choices && data.choices[0] && data.choices[0].message)
? data.choices[0].message.content
: â€˜No response â€” check your API key in Settings.â€™;
addMsg(â€˜assistantâ€™, reply);
chatHistory.push({ role: â€˜userâ€™, content: msg }, { role: â€˜assistantâ€™, content: reply });
})
.catch(function() {
thinkEl.remove();
addMsg(â€˜assistantâ€™, â€˜Connection error. Please check your API key in Settings and try again.â€™);
})
.finally(function() {
sendBtn.disabled = false;
sendBtn.innerHTML = â€˜â¤ Sendâ€™;
});
}

function addMsg(role, text) {
var container = document.getElementById(â€˜chatMessagesâ€™);
var el = document.createElement(â€˜divâ€™);
el.className = â€™chat-msg â€™ + role;
el.textContent = text;
container.appendChild(el);
container.scrollTop = container.scrollHeight;
return el;
}

function clearChat() {
document.getElementById(â€˜chatMessagesâ€™).innerHTML = â€˜â€™;
chatHistory = [];
setTimeout(function() {
addMsg(â€˜assistantâ€™, â€˜Chat cleared. Ready when you are â€” describe the customer.â€™);
}, 100);
}

/* â”€â”€â”€ SETTINGS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function selectProvider(p) {
provider = p;
var optGroq   = document.getElementById(â€˜optGroqâ€™);
var optOpenAI = document.getElementById(â€˜optOpenAIâ€™);
var chkGroq   = document.getElementById(â€˜checkGroqâ€™);
var chkOpenAI = document.getElementById(â€˜checkOpenAIâ€™);

optGroq.classList.toggle(â€˜activeâ€™, p === â€˜groqâ€™);
optOpenAI.classList.toggle(â€˜activeâ€™, p === â€˜openaiâ€™);
chkGroq.classList.toggle(â€˜hiddenâ€™, p !== â€˜groqâ€™);
chkOpenAI.classList.toggle(â€˜hiddenâ€™, p !== â€˜openaiâ€™);

document.getElementById(â€˜apiKeyInputâ€™).placeholder = p === â€˜groqâ€™ ? â€˜gsk_â€¦â€™ : â€˜sk-â€¦â€™;
document.getElementById(â€˜keyHintâ€™).textContent = p === â€˜groqâ€™
? â€˜Get a free key at console.groq.comâ€™
: â€˜Get a key at platform.openai.com/api-keysâ€™;
}

function saveApiKey() {
var key = document.getElementById(â€˜apiKeyInputâ€™).value.trim();
if (!key) {
showKeyStatus(â€˜errâ€™, â€˜Please paste an API key first.â€™);
return;
}
apiKey = key;
localStorage.setItem(â€˜sofa_ai_keyâ€™, apiKey);
localStorage.setItem(â€˜sofa_providerâ€™, provider);
showKeyStatus(â€˜okâ€™, â€˜Key saved. AI Advisor is ready.â€™);
}

function clearApiKey() {
apiKey = â€˜â€™;
localStorage.removeItem(â€˜sofa_ai_keyâ€™);
document.getElementById(â€˜apiKeyInputâ€™).value = â€˜â€™;
showKeyStatus(â€˜errâ€™, â€˜Key removed.â€™);
}

function showKeyStatus(type, msg) {
var el = document.getElementById(â€˜keyStatusâ€™);
el.textContent = msg;
el.className = â€™key-status â€™ + type;
el.classList.remove(â€˜hiddenâ€™);
setTimeout(function() { el.classList.add(â€˜hiddenâ€™); }, 3000);
}

function toggleKeyVisibility() {
var input = document.getElementById(â€˜apiKeyInputâ€™);
var btn   = document.getElementById(â€˜eyeBtnâ€™);
if (input.type === â€˜passwordâ€™) {
input.type = â€˜textâ€™;
btn.style.color = â€˜var(â€“gold)â€™;
} else {
input.type = â€˜passwordâ€™;
btn.style.color = â€˜â€™;
}
}

function updateSettingsUI() {
selectProvider(provider);
if (apiKey) {
document.getElementById(â€˜apiKeyInputâ€™).value = apiKey;
}
populateFeaturedSelect();
}

/* â”€â”€â”€ FEATURED SELECT IN SETTINGS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function populateFeaturedSelect() {
var sel = document.getElementById(â€˜featuredSelectâ€™);
if (!sel) return;
sel.innerHTML = products.map(function(p) {
return â€˜<option value=â€â€™ + p.id + â€˜â€â€™ + (p.id === featuredId ? â€™ selectedâ€™ : â€˜â€™) + â€˜>â€™ +
p.icon + â€™ â€™ + p.name +
â€˜</option>â€™;
}).join(â€™â€™);
}

function changeFeatured() {
var sel = document.getElementById(â€˜featuredSelectâ€™);
featuredId = parseInt(sel.value, 10);
localStorage.setItem(â€˜sofa_featuredâ€™, String(featuredId));
renderFeatured();
}